import{d as e,s as a,r as t,b3 as s,k as r,am as o,w as l,o as d,l as n,n as u,u as i,i as c,_ as m,bV as p,e as f,f as b,bH as v,S as g,bG as h}from"./index-37c42947-1754566720969-2.js";import{f as D}from"./http-979183f6-1754566720969-2.js";import{_ as N}from"./index-63a9873b-1754566720969-2.js";import{_ as y,F as q}from"./Form-92f8b60e-1754566720969-2.js";import{_ as S,a as _}from"./index-17d1a891-1754566720969-2.js";import{S as P}from"./index-51b329c8-1754566720969-2.js";import{I as U}from"./Input-fcee253b-1754566720969-2.js";function I(e={}){return D({url:"/iflorens-order/api/lp/query-order-list",method:"post",data:e})}function x(e={}){return D({url:"/iflorens-order/api/lp/query-unit",method:"post",data:e})}function V(e={}){return D({url:"/iflorens-contract/api/v0/lease-contract/get-lease-contracts-bylp",method:"post",data:e})}function j(e={}){return D({url:"/iflorens-order/api/lp/export-order",method:"post",data:e})}function w(e={}){return D({url:"/iflorens-order/api/lp/save",method:"post",data:e})}function O(e={fieldName:"BU"}){return D({url:"/iflorens-mdm/api/v0/psxlatitem/common-select",method:"get",params:e})}function F(e={}){return D({url:"/iflorens-order/api/lp/query-detail",method:"post",data:e})}function R(e={}){return D({url:"/iflorens-order/api/lp/query-order",method:"post",data:e})}function k(e={}){return D({url:"/iflorens-order/api/lp/batch-upload-operate-confirm",method:"post",data:e})}function C(e={}){return D({url:"/iflorens-file/file/uploadFile?policyKey=lp_upload",method:"post",data:e})}function B(e={}){return D({url:"/iflorens-order/api/lp/page-operate-confirm",method:"post",data:e})}function T(e={}){return D({url:"/iflorens-order/api/lp/is-closed-confirm",method:"post",data:e})}function z(e={}){return D({url:"/iflorens-order/api/lp/query-conditions-source",method:"post",data:e})}function Y(e={}){return D({url:"/iflorens-order/api/lp/check-to-detail",method:"post",data:e})}function A(e={}){return D({url:"/iflorens-order/api/lp/update-unit",method:"post",data:e})}function L(e={}){return D({url:"/iflorens-order/api/lp/delete-confirm-flag",method:"post",data:e})}function M(e={}){return D({url:"/iflorens-order/api/lp/excel-upload-operate-confirm",method:"post",data:e})}function $(e={}){return D({url:"/iflorens-order/api/lp/source/edit",method:"post",data:e})}const K=m(e({__name:"add-modal",props:{open:{type:Boolean,default:!1},title:{type:String,default:"Add New Lease Purchase"},type:{type:String,default:"add"},basicData:{type:Object,default:()=>({})}},emits:["update:open","refreshBasicData"],setup(e,{emit:m}){const D=a(),I=t("YYYY-MM-DD"),x=e,j=m,O=t(!1),F=t({label:"contractNum",value:"contractNum"}),R=t({label:"addressSeqNum",value:"addressSeqNum"}),k=t([{title:"Contract No",dataIndex:"contractNum"}]),C=t([{title:"Location",dataIndex:"addressSeqNum"},{title:"Description",dataIndex:"addressSeqNumDesc"}]),B=t({totalRecord:"totalRecord",currentPage:"currentPage",pageSize:"pageSize",searchValue:"contractNum",responseData:"data",pageIndex:"pageNo"}),T=t({pageNo:1,pageSize:20}),z=t({effdt:s().format(I.value),...T.value}),Y=t(),A=t(""),L=e=>{const a=s();return e&&e>a},M=r({get:()=>x.open,set:e=>(j("update:open",e),e)}),K=()=>{M.value=!1,A.value="",Y.value.resetFields(),j("update:open",!1)},G=o({contractNum:"",addressSeqNum:"",businessUnit:"",asofDt:s(),custId:"",declarationDt:s(),dvOfhPolicy:"",dvPymtTerms:"",onhireDt:""}),H=()=>{if(x.basicData.editFlag>0)return void K();const{asofDt:e,declarationDt:a,contractNum:t,businessUnit:r}=G;Y.value.validate().then((()=>{O.value=!0;const o={...G,asofDt:s(e).format(I.value),declarationDt:s(a).format(I.value)};"edit"===x.type&&(o.id=x.basicData.id);("edit"===x.type?$:w)(o).then((e=>{var a;if(0===e.code){if("edit"===x.type)return j("refreshBasicData"),void K();const s=(null==(a=e.data)?void 0:a.lpOrderRef)||"";A.value="",D.push(`/leasePurchasedDetail?contractNo=${t}&businessUnit=${r}&DeclareRefNo=${s}`),K()}else A.value=e.msg}))})).catch().finally((()=>{setTimeout((()=>{O.value=!1}),300)}))},E=()=>{Y.value.validate("declarationDt")},J=t({contractNum:[{required:!0,message:"Please complete",trigger:"blur"}],addressSeqNum:[{required:!0,message:"Please complete",trigger:"blur"}],businessUnit:[{required:!0,message:"Please complete",trigger:"blur"}],asofDt:[{required:!0,message:"Please complete",trigger:"blur"}],custId:[{required:!0,message:"Please complete",trigger:"blur"}],declarationDt:[{required:!0,trigger:["change","blur"],validator:(e,a)=>a?a&&s(a).format(I.value)>s(G.asofDt).format(I.value)?Promise.reject("Declaration Date must be less than or equal to As Of Date"):Promise.resolve():Promise.reject("Please complete")}]}),Q=e=>{T.value.pageNo=e},W=t([]),X=e=>{const{custId:a,businessUnit:t,addressSeqNum:s,dvOfhPolicy:r,dvPymtTerms:o,contractNum:l}=e;G.contractNum=l,G.businessUnit=t,G.custId=a,G.addressSeqNum=s,G.dvOfhPolicy=r,G.dvPymtTerms=o,V({...z.value,contractNum:G.contractNum}).then((e=>{const a=[...new Map(e.data.map((e=>[e.addressSeqNum,e]))).values()];W.value=a||[]})).catch((()=>{W.value=[]}))};return l(M,(e=>{if(e&&"edit"===x.type){const{contractNum:e,addressSeqNum:a,businessUnit:t,asofDt:r,custId:o,declarationDt:l}=x.basicData;Object.assign(G,{contractNum:e,addressSeqNum:a,businessUnit:t,asofDt:s(r,I.value),custId:o,declarationDt:s(l,I.value)})}})),(a,t)=>{const s=N,r=v,o=y,l=S,m=g,D=P,x=h,j=U,w=_,T=q,$=p;return d(),n($,{title:e.title,onOk:H,width:"600px","confirm-loading":i(O),open:i(M),"onUpdate:open":t[7]||(t[7]=e=>c(M)?M.value=e:null),okText:"Confirm",onCancel:K},{default:u((()=>[i(A)?(d(),n(s,{key:0,type:"error","show-icon":"",message:i(A),closable:"",onClose:t[0]||(t[0]=e=>A.value=""),class:"batch-error-msg"},null,8,["message"])):f("v-if",!0),b(T,{model:i(G),ref_key:"formRef",ref:Y,rules:i(J),"label-col":{span:24},"wrapper-col":{span:24},autocomplete:"off",layout:"vertical"},{default:u((()=>[b(w,{gutter:[16,0]},{default:u((()=>[b(l,{span:12},{default:u((()=>[b(o,{label:"Contract No.",name:"contractNum"},{default:u((()=>[b(r,{modelValue:i(G).contractNum,"onUpdate:modelValue":t[1]||(t[1]=e=>i(G).contractNum=e),columns:i(k),primaryKey:"contractNum",onPageChange:Q,request:i(V),param:i(z),customeRender:"",isShowItemRecord:"",disabled:"edit"===e.type,selectStyle:"width: 100%",showSearch:"",fieldNames:i(F),props:i(B),onSelect:X},null,8,["modelValue","columns","request","param","disabled","fieldNames","props"])])),_:1})])),_:1}),b(l,{span:12},{default:u((()=>[b(o,{label:"Location",name:"addressSeqNum"},{default:u((()=>[b(m,{modelValue:i(G).addressSeqNum,"onUpdate:modelValue":t[2]||(t[2]=e=>i(G).addressSeqNum=e),columns:i(C),fieldNames:i(R),options:i(W),customeRender:"",selectStyle:"width: 100%",disabled:e.basicData.editFlag>0},null,8,["modelValue","columns","fieldNames","options","disabled"])])),_:1})])),_:1}),b(l,{span:12},{default:u((()=>[b(o,{label:"Business Unit",name:"businessUnit"},{default:u((()=>[b(D,{value:i(G).businessUnit,"onUpdate:value":t[3]||(t[3]=e=>i(G).businessUnit=e),disabled:""},null,8,["value"])])),_:1})])),_:1}),b(l,{span:12},{default:u((()=>[b(o,{label:"As Of Date",name:"asofDt"},{default:u((()=>[b(x,{modelValue:i(G).asofDt,"onUpdate:modelValue":t[4]||(t[4]=e=>i(G).asofDt=e),disabled:e.basicData.editFlag>0,format:i(I),"disabled-date":L,onBlur:E},null,8,["modelValue","disabled","format"])])),_:1})])),_:1}),b(l,{span:12},{default:u((()=>[b(o,{label:"Customer ID",name:"custId"},{default:u((()=>[b(j,{value:i(G).custId,"onUpdate:value":t[5]||(t[5]=e=>i(G).custId=e),size:"small",disabled:""},null,8,["value"])])),_:1})])),_:1}),b(l,{span:12},{default:u((()=>[b(o,{label:"Declaration Date",name:"declarationDt"},{default:u((()=>[b(x,{modelValue:i(G).declarationDt,"onUpdate:modelValue":t[6]||(t[6]=e=>i(G).declarationDt=e),disabled:e.basicData.editFlag>0,format:i(I),"disabled-date":L},null,8,["modelValue","disabled","format"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","confirm-loading","open"])}}}),[["__scopeId","data-v-4765d339"]]);export{z as a,Y as b,x as c,F as d,K as e,T as f,L as g,M as h,k as i,C as j,R as k,j as l,V as m,B as p,O as q,I as s,A as u};

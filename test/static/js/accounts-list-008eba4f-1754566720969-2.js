import{d as e,r as a,j as t,am as o,z as s,ao as r,o as l,c as n,f as i,n as u,u as c,G as p,bN as d,m,b as g,a as f,t as v,ak as h,bx as b,ca as C,V as y,c2 as w,_ as S}from"./index-37c42947-1754566720969-2.js";import{c as N}from"./cloneDeep-732b1fea-1754566720969-2.js";import{f as O}from"./http-979183f6-1754566720969-2.js";import{s as x}from"./local-3e1d76e3-1754566720969-2.js";import{_ as L}from"./index-141279d5-1754566720969-2.js";import"./isObjectLike-346e7fe9-1754566720969-2.js";import"./colors-daa4b276-1754566720969-2.js";import"./isVisible-2e753292-1754566720969-2.js";import"./vnode-74605a26-1754566720969-2.js";import"./ResizeObserver.es-8045f32c-1754566720969-2.js";import"./_getTag-62bb18d6-1754566720969-2.js";function P(e){return O({url:"/sone-crm/api/v0/customer/customer-select",method:"post",data:e})}const k=[{labelName:"Customer Group",labelAlign:"left",tip:"",value:"",key:"customerGroup",operatorOptions:{operator:"in",options:["in"]},propsData:{customeRender:!0,columns:[{title:"Customer Group",dataIndex:"customerGroup"}],fieldNames:{label:"customerGroup",value:"customerGroup"},selectProps:{responseData:"data.data",searchValue:"fuzzy"},selectParam:{},request:function(e){return O({url:"/sone-crm/api/v0/customer/customer-group-select",method:"post",data:e})},options:[],dropdownMatchSelectWidth:!0,value:[]}},{labelName:"Customer ID",labelAlign:"left",tip:"",value:"",key:"customerCode",operatorOptions:{operator:"in",options:["in"]},propsData:{customeRender:!0,columns:[{title:"Customer ID",dataIndex:"customerCode"},{title:"Legal Name",dataIndex:"customerName"}],fieldNames:{label:"customerCode",value:"customerCode"},selectProps:{responseData:"data.data",searchValue:"fuzzy"},selectParam:{},request:P,options:[],dropdownMatchSelectWidth:!0,value:[]}},{labelName:"Legal Name",labelAlign:"left",tip:"",value:"",key:"customerName",operatorOptions:{operator:"begins with",options:["begins with"]},propsData:{customeRender:!0,columns:[{title:"Customer ID",dataIndex:"customerCode"},{title:"Legal Name",dataIndex:"customerName"}],primaryKey:"customerName",fieldNames:{label:"customerName",value:"customerName"},selectProps:{responseData:"data.data",searchValue:"fuzzy"},selectParam:{},request:P,options:[],dropdownMatchSelectWidth:!0,value:[]}},{labelName:"Nature of Business",labelAlign:"left",tip:"",value:"",key:"natureOfBusiness",operatorOptions:{operator:"contains",options:["contains"]},propsData:{optionLabelProp:"children",options:[{label:"Shipping Service",value:"Shipping Service",key:"Shipping Service"},{label:"Freight Forwarding Service",value:"Freight Forwarding Service",key:"Freight Forwarding Service"},{label:"Shipping Agency",value:"Shipping Agency",key:"Shipping Agency"},{label:"Container Trading & Leasing",value:"Container Trading & Leasing",key:"Container Trading & Leasing"},{label:"Tank Operating",value:"Tank Operating",key:"Tank Operating"},{label:"Others",value:"Others",key:"Others"}],value:[],dropdownMatchSelectWidth:!0}},{labelName:"KAM",labelAlign:"left",tip:"",value:"",key:"accountOwner",operatorOptions:{operator:"in",options:["in"]},propsData:{customeRender:!0,columns:[{title:"login Name",dataIndex:"loginName"},{title:"User Name",dataIndex:"loginNameCn"}],fieldNames:{label:"loginName",value:"loginName"},selectProps:{responseData:"data.data",searchValue:"fuzzy"},selectParam:{},request:function(e){return O({url:"/sone-crm/api/v0/customer/kam-select",method:"post",data:e})},options:[],dropdownMatchSelectWidth:!0,value:[]}}],z={class:"list-container"},A=["onClick"],D={class:"dropdown-card"};function j(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!h(e)}const T=S(e({__name:"accounts-list",setup(e){const h=a(x("get","accountsList-search-params",{})),{open:S,close:P}=w(),T=a(!1),I=a("My Accounts"),R=a(["All Accounts","Recently Viewed","My Accounts"]),B=t(),V=a({controls:N(k)}),q=a([{title:"Customer Group",field:"customerGroup",sortable:!0,width:133},{title:"Customer ID",field:"customerCode",sortable:!0,slots:{default:"customerCode"},width:130},{title:"Legal Name",field:"customerName",sortable:!0,width:212},{title:"Nature of Business",field:"natureOfBusiness",sortable:!0,minWidth:330,showOverflow:"false",slots:{default:({row:e})=>{if(e.natureOfBusiness&&"-"!==e.natureOfBusiness){const a=e.natureOfBusiness.split(",").map((e=>e.trim()));return a.length>2?[...a.slice(0,2).map((e=>i(m("flTag"),{className:"processing",style:"margin-right: 4px;"},j(e)?e:{default:()=>[e]}))),i(m("a-tooltip"),{placement:"top",content:i("div",null,[a.slice(3).map((e=>i(m("flTag"),{className:"processing",style:"margin-right: 4px;"},j(e)?e:{default:()=>[e]})))])},{default:()=>[i("span",{style:"margin-right: 4px;"},[g("+ "),a.length-2])]})]:a.map((e=>i(m("flTag"),{className:"processing",style:"margin-right: 4px;"},j(e)?e:{default:()=>[e]})))}return"-"}}},{title:"KAM",field:"accountOwner",sortable:!0,width:120,slots:{default:"accountOwner"}}]),G=o({loading:!1,border:"none",stripe:!0,align:null,showHeaderOverflow:!0,showOverflow:"tooltip",size:"small",height:"100%",sortConfig:{remote:!0,multiple:!1},columnConfig:{resizable:!0},scrollX:{enabled:!0},scrollY:{enabled:!0},rowConfig:{height:40,isHover:!0},seqConfig:{filterConfig:{remote:!0}},pagerConfig:{currentPage:1,pageSize:20,total:0,layouts:["Total","PrevPage","JumpNumber","NextPage","Sizes"]},columns:[...q.value],data:[]}),M=a([]),E=e=>{const a=[{label:"All Accounts",value:"ALL"},{label:"Recently Viewed",value:"HISTORY"},{label:"My Accounts",value:"OWNER"}];return a.find((a=>a.label===e))?a.find((a=>a.label===e)):a.find((a=>a.value===e))},_=e=>{G.loading=!0;const a={...h.value,page:{currentPage:G.pagerConfig.currentPage,pageSize:G.pagerConfig.pageSize},sort:M.value};var t;a.queryType=e||E(I.value).value,x("set","accountsList-search-params",a),x("set","accountsList-search-form",V.value),(t=a,O({url:"/sone-crm/api/v0/customer/customer-list",method:"post",data:t})).then((e=>{e.data.data.forEach((e=>{e.customerGroup=e.customerGroup||"-",e.natureOfBusiness=e.natureOfBusiness||"-",e.salesSupport=e.salesSupport||"-"})),G.data=e.data.data,G.pagerConfig.total=e.data.totalRecord,G.pagerConfig.pageSize=e.data.pageSize})).finally((()=>{G.loading=!1}))},W=()=>{_()},F={sortChange(e){M.value=e.sortList.map((e=>({field:e.field,order:e.order}))),_()}},U=()=>{V.value={controls:N(k)},x("set","accountsList-search-params",""),x("set","accountsList-search-form",""),h.value="",M.value=[],G.pagerConfig.currentPage=1,G.pagerConfig.pageSize=20,_()},H=e=>{h.value=e,G.pagerConfig.currentPage=1,_()},K=e=>{G.pagerConfig.currentPage=null==e?void 0:e.currentPage,G.pagerConfig.pageSize=null==e?void 0:e.pageSize,_()},Y=e=>{p((()=>{G.columns=e}))},J=(e,a)=>{G.columns=a.filter((a=>e.includes(a.title))),q.value=a},{proxy:X}=y(),$=e=>{T.value||(S("accountsList"),T.value=!0,function(e){return O({url:"/sone-crm/api/v0/customer/export-customer-list",method:"post",data:e,responseType:"blob",headers:{"Content-Type":"application/json;charset=utf-8",Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"},timeout:3e5})}(e).then((async e=>{P("accountsList"),T.value=!1;const a=window.URL.createObjectURL(new Blob([e])),t=document.createElement("a");t.href=a,t.download="CRM Accounts.xlsx",document.body.appendChild(t),t.click(),t.remove()})).catch((()=>{P("accountsList"),T.value=!1})))},Q=()=>{const e={queryType:E(I.value).value,...h.value,page:{currentPage:G.pagerConfig.currentPage,pageSize:G.pagerConfig.pageSize},sort:M.value};$(e)},Z=()=>{document.querySelectorAll(".iflorens-ui-select-dropdown, .iflorens-ui-picker-dropdown").forEach((e=>{e.style.display="none"}))};return s((()=>{const e=document.querySelector(".page-middle");e&&e.addEventListener("scroll",Z);const a=B.query.view;if(a)return _(a),void(I.value=E(a).label);_()})),r((()=>{const e=document.querySelector(".page-middle");e&&e.removeEventListener("scroll",Z)})),(e,a)=>{const t=b,o=C,s=L,r=d;return l(),n("div",z,[i(r,{title:"",searchWidth:300,isShowCollectBtn:!1,isShowExportBtn:!1,headerDraggableDisabledArr:["Customer ID"],headerDisabled:["Customer ID"],form:V.value,"onUpdate:form":a[1]||(a[1]=e=>V.value=e),gridOptions:G,gridEvents:F,tableColumns:q.value,formSaveParam:{searchType:"accountsList"},fetch:c(O),onReset:U,onSearch:H,onPageChange:K,onDragableChange:J,onTableFieldChange:Y},{customerCode:u((({row:e})=>[f("span",{class:"special-text",onClick:a=>(e=>{X.$goPage("/crm/accounts/detali",{id:e.id,from:"V4",view:E(I.value).value})})(e)},v(e.customerCode),9,A)])),accountOwner:u((({row:e})=>[g(v(e.userName||"-"),1)])),"collect-default":u((()=>[f("div",D,[i(t,{onChange:W,modelValue:I.value,"onUpdate:modelValue":a[0]||(a[0]=e=>I.value=e),options:R.value,trigger:["click"],isShowDelIcon:!1},null,8,["modelValue","options"])])])),"table-top-left":u((()=>[i(s,{placement:"top"},{title:u((()=>a[2]||(a[2]=[f("span",null,"Export",-1)]))),default:u((()=>[i(o,{loading:T.value,onBtnClick:Q},{default:u((()=>a[3]||(a[3]=[g("Export")]))),_:1},8,["loading"])])),_:1})])),_:1},8,["form","gridOptions","tableColumns","fetch"])])}}}),[["__scopeId","data-v-6ad8a4a5"]]);export{T as default};
